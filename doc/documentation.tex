\documentclass{article}
\nonstopmode                     % It's pretty annoying when pdflatex starts up a command line when it encounters an error -- disable that functionality
\usepackage[hidelinks]{hyperref} % This turns references into nice PDF links. I've disabled the link highlights for aesthetic reasons.
\usepackage{listings}            % This is used for source code inclusion

% Basic title setup
\title{Trajectory Optimization Framework}
\author{Johnathan Van Why}

\begin{document}
	% This actually displays the title
	\maketitle
	\section{Introduction}
		This framework is designed for the optimization of trajectories for robotic systems.
		It can handle underactuated and hybrid systems. In the future, it will have support for multiple
		"phases", or time periods in which specific dynamics are enforced.

		The framework makes use of the MATLAB Symbolic Toolbox to aid in problem formulation and manipulation.
		The actual optimization, however, is almost always numerical. By keeping the problem in a symbolic form, we
		allow for the implementation of a mode where the optimization algorithm and problem are formulated together, leading
		to a final solver optimized for the specific problem's structure.

		This document gives a basic description of how to use the framework. It also covers the architectural design of the framework
		and details on some of the most important algorithms contained within the framework. In addition to this document, code samples
		% \lstinline|/* code */| puts in an inline code segment
		are located within the \lstinline|samples/| directory and function as additional documentation for the optimizer.

	\section{Usage}
		At the moment, the interface to the optimizer is undergoing a re-design, so it is likely to change in the near future.
		This section will hopefully be kept up to date with changes.

		One thing that currently appears to be invariant is the usage of a central structure, called the "scenario" structure.
		The scenario structure contains all information necessary to run an optimization -- it is incrementally filled out by the optimizer
		as it completes the various stages of problem setup and optimization. The final
		scenario structure contains the results of the optimization,
		and should contain all information that may need to be saved for future use.

		% Prevent this from being split across pages, or it will look nasty.
		\begin{samepage}
			The overall workflow for using the optimizer is as follows:
			\begin{enumerate}
				\item Incrementally set up the problem by calling optimizer functions to generate structures.
				\item Call \lstinline|traj_optimize()| on the scenario structure to do the optimization.
			\end{enumerate}
		\end{samepage}

	\section{Structures}
		This section contains information on all the values in the structures used to define and optimize the problem.
		Since the optimizer is built around these structures, correctly setting them up is the majority of the work required to
		interface with the framework.

		Note: This documentation reflects the plans for the next revision of the framework's API.

		Each structure contains a \lstinline|struct_type| string, which states the "type" of the structure.
		This allows for error checking and for mixing and matching optimizer functions with structure types.

		Additionally, each structure contains a \lstinline|version| integer. This version is incremented every time a breaking
		change is made to one of the structures. All versions are kept in-sync, since the structures contain each other.
		Each time the version number is incremented, functions for updating all relevant structures should be created for backwards
		compatibility. The optimizer will automatically update any outdated structures passed in to it. In this way, a scenario structure
		that is saved at one point in time will remain usable, even if the optimizer is updated.

		The ordering of these structures in this section of the documentation reflects
		the nesting of the structures inside the scenario structure.

		\subsection{State}
			\label{sec:state} % Allow documentation for other structures to reference this structure

			This structure represents a dynamic state. It is used in initializing the system dynamics.

			% Put in a blank line so it looks nice
			\vspace{\baselineskip}

			\begin{tabular}{ p{.15\textwidth} | p{.1\textwidth} | p{.6\textwidth}}
				Field                    & Type    & Description                                                                 \\ \hline
				\lstinline|names|        & \raggedright Cell array of strings & A column array containing the name of each element of
				                                                   the state. Its size matches the size of the overall state.    \\[1ex]
				\lstinline|struct_type|  & String  & The type of the struct -- always 'state'                                    \\[1ex]
				\lstinline|version|      & \raggedright Positive Integer & The version number of this structure.
			\end{tabular}

		\subsection{Input}
			\label{sec:input} % Allow documentation for other structures to reference this structure

			This structure represents an input to the system. It is used for initializing dynamics and jump maps (when and if
			jump maps are implemented).\nopagebreak

			% Blank line for looks
			\vspace{\baselineskip}\nopagebreak

			\begin{tabular}{ p{.15\textwidth} | p{.1\textwidth} | p{.6\textwidth}}
				Field                    & Type                               & Description                                      \\ \hline
				\lstinline|names|        & \raggedright Cell array of strings & A column array containing the name of each element of
												this input. It has the same number of elements an the
												input it represents.                             \\[1ex]
				\lstinline|struct_type|  & String                             & This struct's type. Always 'input'               \\[1ex]
				\lstinline|version|      & \raggedright Positive Integer      & The version number of this structure.
			\end{tabular}

		\subsection{Dynamics}
			\label{sec:dynamics} % Allow documentation for other structures to reference this structure

			This structure contains the dynamic equations for the system (or one set of dynamics for hybrid dynamics systems).

			% Blank line for looks
			\vspace{\baselineskip}

			\begin{tabular}{ p{.17\textwidth} | p{.15\textwidth} | p{.53\textwidth}}
				Field                    & Type                               & Description                                      \\ \hline
				\lstinline|dynamics_fcn| & \raggedright Anonymous function    & The function dx = f(x, u) describing the system's
				                                                                dynamics.                                        \\[1ex]
				\lstinline|input|        & \hyperref[sec:input]{Input}        & The \hyperref[sec:input]{input} struct corresponding
				                                                                to this set of dynamics                          \\[1ex]
				\lstinline|state|        & \hyperref[sec:state]{State}        & The \hyperref[sec:state]{state} struct representing
				                                                                this dynamics's state input (and output).        \\[1ex]
				\lstinline|struct_type|  & String                             & This struct's type. Always 'dynamics'            \\[1ex]
				\lstinline|version|      & \raggedright Positive Integer      & The version number of this structure.
			\end{tabular}

		\subsection{Phase}
			\label{sec:phase} % This structure is referenced from the Scenario structure's documentation (and possibly other places as well).

			This structure encodes information on one dynamic phase.

			% Blank line for formatting
			\vspace{\baselineskip}

			\begin{tabular}{ p{.15\textwidth} | p{.13\textwidth} | p{197pt}}
				Field                    & Type                               & Description                                      \\ \hline
				\lstinline|dynamics|     & \hyperref[sec:dynamics]{Dynamics}  & The dynamics for this phase.                     \\[1ex]
				\lstinline|intervals|    & \raggedright Positive Integer      & The number of time intervals in the
				                                                                discrete
				                                                                approximation to the underlying continuous-time
				                                                                problem.                                         \\[1ex]
				\lstinline|struct_type|  & String                             & This struct's type. Always 'phase'               \\[1ex]
				\lstinline|version|      & \raggedright Positive Integer      & The version number of this structure.
			\end{tabular}

		\subsection{Scenario}
			\begin{itemize}
				\item To be written... % todo
			\end{itemize}
\end{document}
